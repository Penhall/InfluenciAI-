# 05.2 - Execução Local (Dev)

Este guia descreve como executar a stack local do InfluenciAI para desenvolvimento.

Pré‑requisitos
- Docker Desktop
- .NET SDK 10 (RC) — o repositório já inclui `global.json` e usa pacotes RC

Subir dependências (Postgres/Redis/RabbitMQ)
```
docker compose up -d
```

Banco de dados
- O serviço de seed aplica as migrações automaticamente em `Development` (via `Database.Migrate`).
- Alternativa manual: `dotnet ef database update --project src/Infra/InfluenciAI.Infrastructure --startup-project src/Server/InfluenciAI.Api`

API
```
dotnet run --project src/Server/InfluenciAI.Api
```
- Swagger: http://localhost:5228/swagger
- Usuário seed (dev): `admin@local` / `Admin!234`

Desktop (WPF)
```
dotnet run --project src/Client/InfluenciAI.Desktop
```
- O Desktop já aponta para `http://localhost:5228` em `src/Client/InfluenciAI.Desktop/appsettings.json`.

 Autenticação & Tokens
 - Login: `POST /auth/login` retorna `{ access_token, refresh_token }`.
 - Auto-refresh: o Desktop usa um handler que, ao receber `401`, faz `POST /auth/refresh` uma vez e repete a requisição.
 - Logout: `POST /auth/logout` (revoga um refresh token do usuário autenticado) e `POST /auth/logout/all` (revoga todos os tokens do usuário).

Testes
```
dotnet test tests/InfluenciAI.Tests/InfluenciAI.Tests.csproj
```

Notas
- Em dev, CORS pode permitir origens abertas se `Cors:AllowAllInDev=true` no `appsettings.Development.json` da API.
- Segredos (JWT Key) estão em `appsettings.Development.json`; para produção, usar variáveis de ambiente/Key Vault.

Próximos Passos Técnicos
- Tests: estabilizar testes de integração (host de teste + InMemory) e cobrir `/auth/logout/all` e CRUD de usuários por tenant.
- CI/CD: adicionar pipeline (build, testes, cobertura opcional) e gates; publicar binários do Desktop em canal interno.
- Segurança: externalizar segredos (JWT, conexões), revisar políticas de roles/escopos por tenant e adicionar limpeza de tokens.
- Observabilidade: parametrizar exporters e adicionar dashboards iniciais.
- Desktop: melhorar UX (mensagens, loading states), consolidar navegação e adicionar indicador de sessão.
